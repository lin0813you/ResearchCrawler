# 期末專題成果報告：ResearchCrawler 研究計劃資料爬蟲與可視化平台

**課程名稱：** 網際服務軟體工程

**小組成員：** 林士祐、吳傢澂、洪群倫、洪唯仁、楊育丞

**專案儲存庫：** [github.com/lin0813you/ResearchCrawler](https://github.com/lin0813you/ResearchCrawler)

---

## 1. 專題簡介與問題定義

### 1.1 背景與痛點
在台灣學術環境中，國科會計畫資料是研究能量的重要指標。然而，官方查詢系統介面操作零碎，且一次僅能查詢單一年度，導致使用者若要彙整一位計畫主持人（PI）近年來的完整研究軌跡（如近五年資料），必須進行多次重複查詢與手動整理。

### 1.2 解決方案：ResearchCrawler
本專案開發了 **ResearchCrawler**，這是一個全端、無伺服器架構的自動化查詢平台。
*   **單一輸入，五年呈現**：使用者僅需輸入「主持人姓名 (pi_name)」，系統即自動爬取 114 至 110 年度的資料。
*   **結構化數據**：將非結構化的網頁資訊轉換為中文欄位清晰的 JSON 資料。
*   **可視化體驗**：前端將計畫摘要、關鍵字、期程與金額完整呈現，提升學術資訊的獲取效率。

<!-- ![簡報第 2 頁圖片：產品介面預覽 - 單一輸入，五年呈現](p2.png) -->

---

## 2. 系統架構與服務選型理由

本專案採用 AWS Serverless 架構，確保系統在高併發查詢下仍能保持低成本與高效能。

### 2.1 服務選型清單
*   **AWS Lambda**：執行後端核心邏輯。透過 **Mangum** 適配器運行 **FastAPI**，處理爬蟲與資料正規化，優點是「不使用不計費」。
*   **Amazon API Gateway (HTTP API)**：作為後端入口，負責接收前端請求並轉發至 Lambda，提供 `/api/awards` 等端點。
*   **Amazon S3 (Static Website Hosting)**：儲存由 Vite 建置的前端靜態檔案。
*   **Amazon CloudFront**：作為前端 CDN，加速靜態資源加載並提供 HTTPS 加密連線。
*   **Amazon CloudWatch**：收集執行記錄 (Logs) 與錯誤日誌，確保系統可觀測性。

### 2.2 邊緣層優化
*   **Cloudflare**：在 AWS 之前加入 Cloudflare 作為安全與效能層。
    *   **減少 Egress Costs**：透過 Edge Cache 緩存靜態資源與重複的 API 響應，減少 AWS 資料外傳費用。
    *   **WAF 防護**：阻擋惡意爬蟲與非法請求，保護 AWS Origin 的安全。

<!-- ![簡報第 3 頁圖片：系統架構全景圖](p3.png) -->

<!-- ![簡報第 14 頁圖片：專案技術棧概覽](p14.png) -->

---

## 3. 核心流程說明

### 3.1 流程一：自動化查詢與數據解析 (Query Flow)
這是專案最核心的「數據獲取」流程，分為以下步驟：
1.  **使用者發送請求**：前端傳送 `GET /api/awards?pi_name=...`。
2.  **後端觸發**：API Gateway 調用 Lambda，Lambda 啟動 `crawler.py`。
3.  **多年度爬取**：系統模擬請求國科會伺服器，自動涵蓋 114–110 年度資料。
4.  **模型轉換**：使用 `models.py` (Pydantic) 將解析後的 HTML 轉化為包含 `award_year`、`organ`、`total_amount`、`impact` (摘要) 等 10 個欄位的 JSON 物件。
5.  **結果回傳**：前端 React 接收資料後，渲染於查詢結果表格中。

<!-- ![簡報第 6 頁圖片：API 契約定義](p6.png) -->
<!-- ![簡報第 7 頁圖片：回傳資料欄位 JSON 範例](p7.png) -->

### 3.2 流程二：AWS SAM Serverless 部署流程 (DevOps Flow)
本專案落實 IaC (基礎設施即代碼)，避免手動點選控制台：
1.  **構建**：`sam build --use-container`。透過 Docker 容器環境編譯 Python 代碼。
2.  **部署**：`sam deploy --guided`。自動建立 CloudFormation 堆疊，產出 API Endpoint、S3 Bucket 等資源。
3.  **前端同步**：使用 `aws s3 sync dist s3://<BucketName> --delete` 同步前端代碼並更新快取。

<!-- ![簡報第 8 頁圖片：IaC 部署藍圖](p8.png) -->
<!-- ![簡報第 9 頁圖片：部署流程圖與指令](p9.png) -->

---

## 4. 非同步設計說明 (SQS/SNS/EventBridge)

根據專案擴展規劃，我們針對爬蟲的潛在瓶頸設計了非同步處理方案：
*   **SQS 緩衝處理**：由於查詢 5 個年度的資料可能耗時 10 秒以上，未來可將請求放入 **Amazon SQS**，讓後端 Lambda 異步執行。
*   **DLQ (Dead Letter Queue)**：若國科會伺服器反應超時或格式變動，失敗的請求將進入 DLQ，以便維運團隊分析原因。
*   **EventBridge 排程**：可設定每月初自動抓取熱門計畫，將結果存入快取庫，實現使用者查詢時「零延遲」的回饋。

---

## 5. Observability 設計 (Logs / Metrics / Alarms)

依據 `AWS_SERVICES.md`，我們利用 **CloudWatch** 實作監控：
*   **CloudWatch Logs**：記錄每次 `crawler.py` 的解析狀態。若爬蟲解析不到 `plan_name`，日誌會噴出錯誤訊息，供團隊除錯。
*   **Lambda Metrics**：追蹤 `Duration` 指標。若查詢近五年資料的平均時間超過 20 秒，系統將發出效能預警。
*   **API Gateway Metrics**：監控 API 的調用次數，防止因短時間大量查詢導致的成本飆升。

---

## 6. 安全性與 IAM 設計原則

*   **IAM 最小權限**：Lambda 的 Execution Role 僅被授予存取特定 Log Group 的權限，且對 S3 Bucket 的存取僅限於必要的部署操作。
*   **邊緣防護 (WAF)**：如簡報第 13 頁所示，利用 Cloudflare 擋掉異常的 Bot 流量，防止專案 API 被第三方惡意調用。
*   **環境變數保護**：前端 `VITE_API_BASE_URL` 與 API Gateway 的敏感路徑，皆透過 `.env` 檔案與 SAM Parameter 管理，不暴露於原始碼中。

<!-- ![簡報第 13 頁圖片：Cloudflare 安全防護原理](p13.png) -->

---

## 7. 成本與限制說明

### 7.1 成本優化
*   **Serverless 架構**：無人使用時成本幾乎為 $0，極大程度利用了 AWS Lambda 與 CloudFront 的免費額度 (Free Tier)。
*   **Cloudflare Cache**：透過緩存機制，有效減少了 CloudFront 的外傳流量費，實現「教學版」的高性價比配置。

<!-- ![簡報第 12 頁圖片：Cloudflare 成本削減分析](p12.png) -->

### 7.2 系統限制
*   **依賴第三方網站**：爬蟲高度依賴國科會網站結構。若對方更動 HTML ID 或 Class 名稱，系統需更新 `crawler.py` 的 Selector 邏輯。
*   **快取依賴性**：如 `README.md` 所述，`/api/awards/{plan_name}` 端點依賴於先前呼叫產生的快取，若操作順序不對將無法取得細節。

---

## 8. 個人分工說明 (依據團隊貢獻)

<!-- |<|<| 姓名 | 主要負責
| :--- | :--- |
| **林士祐** | 後端架構設計、AWS SAM 部署、FastAPI 框架 (`main.py`, `lambda_handler.py`)。 |
| **吳傢澂** | 爬蟲核心開發 (`crawler.py`)、國科會網頁封包分析與解析邏輯。 |
| **洪群倫** | React 前端 UI 開發、Vite 配置、Vivid 圖表數據對接。 |
| **洪唯仁** | API 契約制定、Pydantic 模型 (`models.py`)、資料正規化。 |
| **楊育丞** | Cloudflare 整合 (WAF/Cache)、專案文檔撰寫、成本效益分析。 | -->

---
**附件：實作證據截圖請參閱 `evidence/` 資料夾。**
